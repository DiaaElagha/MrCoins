@model Coins.Web.Models.ViewModels.StoreVouchersVM
@using Coins.Web.Models.ViewModels
@using Coins.Core.Constants.Enums
@{
    ViewData["Title"] = "المكافأت";
}

@section Css{
    <style>
    </style>
}

<div class="kt-portlet kt-portlet--mobile" style="background-color:rgb(0 0 0 / 0.00)!important">
    <partial name="_MsgPartial" />

    <form asp-action="Index" method="post" enctype="multipart/form-data">
        <div class="card border-0 p-2">
            <div class="card-body">
                <h5 class="sm-bolder">المكافأت</h5>
                <h6 class="pt-1 pb-1">أنشئ مكافآت يمكن لعملائك استردادها بالنقاط التى ربحوها</h6>
                <a href="#" class="color-mrcoins"><u>تعرف على المزيد حول كيفية استرداد العملاء للنقاط</u></a>
            </div>
        </div>

        <div class="card border-0 mt-3 p-2">
            <div class="card-body mt-2">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="Name" class="form-control-label sm-bolder">
                                <span class="kt-switch kt-switch--sm kt-switch--outline kt-switch--icon kt-switch--brand">
                                    <label>
                                        <input type="checkbox" asp-for="IsActiveVoucherDiscount" class="activation__checkbox1">
                                        <span></span>
                                        <label class="pl-2 sm-bolder font-size-panel">خصم على الطلب</label>
                                    </label>
                                </span>
                            </label>
                            <br />
                            <span class="color-gray">يستطيع العملاء استبدال نقاطهم بخصم على طلباتهم القادمة</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="Name" asp-for="NumberRedeemedCoinsForEveryCurrency" class="form-control-label sm-bolder" style="margin-bottom:13px!important"></label>
                            <input asp-for="NumberRedeemedCoinsForEveryCurrency" class="form-control border-gray activation__input2">
                            <span class="color-gray">يكتسب العملاء خصم بقيمة 1 دينار مقابل كل x نقطة يتم استبدالها</span>
                            <span asp-validation-for="NumberRedeemedCoinsForEveryCurrency" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="Name" class="form-control-label sm-bolder" style="margin-bottom:0px!important">
                                <span class="kt-switch kt-switch--sm kt-switch--outline kt-switch--icon kt-switch--brand">
                                    <label>
                                        <input type="checkbox" asp-for="IsActiveVoucherDiscountExpiredAfterDay" class="activation__checkbox2">
                                        <span></span>
                                        <label class="pl-2 sm-bolder font-size-panel">تفعيل صلاحية القسيمة</label>
                                    </label>
                                </span>
                            </label>
                            <input asp-for="VoucherDiscountExpiredAfterDay" class="form-control border-gray activation__input2">
                            <span class="color-gray">تنتهي صلاحية هذه القسيمة بعد X يوم من الاستبدال</span>
                            <span asp-validation-for="VoucherDiscountExpiredAfterDay" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="Name" class="form-control-label sm-bolder" style="margin-bottom:0px!important">
                                <span class="kt-switch kt-switch--sm kt-switch--outline kt-switch--icon kt-switch--brand">
                                    <label>
                                        <input type="checkbox" asp-for="IsActiveMinCoinsRedeemVoucherDiscount" class="activation__checkbox2">
                                        <span></span>
                                        <label asp-for="DefineMinCoinsRedeemVoucherDiscount" class="pl-2 sm-bolder font-size-panel"></label>
                                    </label>
                                </span>
                            </label>
                            <input asp-for="DefineMinCoinsRedeemVoucherDiscount" class="form-control border-gray activation__input2">
                            <span class="color-gray">يجب على العملاء استبدال x نقطة على الاقل</span>
                            <span asp-validation-for="DefineMinCoinsRedeemVoucherDiscount" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="Name" class="form-control-label sm-bolder" style="margin-bottom:0px!important">
                                <span class="kt-switch kt-switch--sm kt-switch--outline kt-switch--icon kt-switch--brand">
                                    <label>
                                        <input type="checkbox" asp-for="IsActiveMaxCoinsToSpentVoucherDiscount" class="activation__checkbox2">
                                        <span></span>
                                        <label asp-for="DefineMaxCoinsToSpentVoucherDiscount" class="pl-2 sm-bolder font-size-panel"></label>
                                    </label>
                                </span>
                            </label>
                            <input asp-for="DefineMaxCoinsToSpentVoucherDiscount" class="form-control border-gray activation__input2">
                            <span class="color-gray">العملاء يستطيعون استبدال x نقطة كحد اقصى</span>
                            <span asp-validation-for="DefineMaxCoinsToSpentVoucherDiscount" class="text-danger"></span>
                        </div>
                    </div>
                </div>


            </div>


        </div>

        <div class="card border-0 mt-3 p-2">
            <div class="card-body mt-2">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="Name" class="form-control-label sm-bolder">
                                <span class="kt-switch kt-switch--sm kt-switch--outline kt-switch--icon kt-switch--brand">
                                    <label>
                                        <input type="checkbox" asp-for="IsActiveFirstTimeVoucher" class="activation__checkbox5">
                                        <span></span>
                                        <label class="pl-2 sm-bolder font-size-panel">عرض اول مرة</label>
                                    </label>
                                </span>
                            </label>
                            <br />
                            <span class="color-gray">شجع العملاء الجدد على القدوم الى متجرك من خلال تقديم عرض فريد لهم عند أول طلب لهم</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="Name" asp-for="VoucherFirstTime.VoucherNameAr" class="form-control-label sm-bolder" style="margin-bottom:13px!important"></label>
                            <input asp-for="VoucherFirstTime.VoucherNameAr" class="form-control border-gray activation__input5">
                            <span asp-validation-for="VoucherFirstTime.VoucherNameAr" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="Name" asp-for="VoucherFirstTime.VoucherNameEn" class="form-control-label sm-bolder" style="margin-bottom:13px!important"></label>
                            <input asp-for="VoucherFirstTime.VoucherNameEn" class="form-control border-gray activation__input5">
                            <span asp-validation-for="VoucherFirstTime.VoucherNameEn" class="text-danger"></span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="Name" asp-for="VoucherFirstTime.VoucherDescrptionAr" class="form-control-label sm-bolder" style="margin-bottom:13px!important"></label>
                            <textarea asp-for="VoucherFirstTime.VoucherDescrptionAr" class="form-control border-gray activation__input5" rows="3"></textarea>
                            <span asp-validation-for="VoucherFirstTime.VoucherDescrptionAr" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="Name" asp-for="VoucherFirstTime.VoucherDescrptionEn" class="form-control-label sm-bolder" style="margin-bottom:13px!important"></label>
                            <textarea asp-for="VoucherFirstTime.VoucherDescrptionEn" class="form-control border-gray activation__input5" rows="3"></textarea>
                            <span asp-validation-for="VoucherFirstTime.VoucherDescrptionEn" class="text-danger"></span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="Name" asp-for="VoucherFirstTime.VoucherTerms" class="form-control-label sm-bolder" style="margin-bottom:13px!important"></label>
                            <textarea asp-for="VoucherFirstTime.VoucherTerms" class="form-control border-gray activation__input5" rows="5"></textarea>
                            <span asp-validation-for="VoucherFirstTime.VoucherTerms" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-5">
                        <div class="form-group">
                            <label for="Name" asp-for="VoucherFirstTime.VoucherMainAttachmentId" class="form-control-label sm-bolder"></label>
                            <input asp-for="VoucherFirstTime.VoucherMainAttachmentId" type="file" class="form-control activation__input5">
                            <span asp-validation-for="VoucherFirstTime.VoucherMainAttachmentId" class="text-danger"></span>
                        </div>
                    </div>
                </div>

            </div>

            <div class="form-group pt-3">
                <button type="submit" class="rounded btn btn-primary">حفظ التغيرات</button>
            </div>
        </div>

    </form>

    <div class="card border-0 p-4 mt-3">
        <div class="row pt-4 pb-2">
            <div class="col-md-10">
                <h5 class="bolder">
                    القسائم
                    <small class="ml-3 color-mrcoins sm-bolder">يجب اضافة قسيمة واحد على الأقل</small>
                </h5>
            </div>
            <div class="col-md-2 text-right">
                <a href="~/StoreVouchers/Create" title="اضافة قسيمة جديد" class="bolder color-mrcoins">
                    <i class="la la-plus-circle fa-lg "></i>
                    إضافة قسيمة
                </a>
            </div>
        </div>
        <span class="color-gray pb-4">كافئ عملائك بمكافآت من مستويات مختلفة يمكن استبدالها بنقاطهم التى ربحوها</span>
        <form class="DTForm">
            <div class="row">
                <div class="col-5">
                    <input class="form-control" type="search" placeholder="ابحث بالاسم  ..." name="SearchKey">
                </div>
            </div>
        </form>

        <!--begin: Datatable -->
        <table class="table table-striped table-bordered table-hover table-checkable" id="dataTableId" style="text-align:center">
            <thead>
                <tr>
                    <th>اسم القسيمة</th>
                    <th>اسم القسيمة</th>
                    <th>عدد العملات</th>
                    <th>الحالة</th>
                    <th>تنتهي بعد</th>
                    <th>تاريخ الانشاء</th>
                    <th width="10%">العمليات</th>
                </tr>
            </thead>
        </table>

        <!--end: Datatable -->

    </div>

</div>


@section Scripts {

    <script>
        $(".activation__checkbox2").change(function () {
            var input_element = $(this).closest('.form-group').find('.activation__input2');
            if (this.checked) {
                $(input_element).prop('disabled', false);
            } else {
                $(input_element).prop('disabled', true);
            }
        });

        $(".activation__checkbox5").change(function () {
            var input_element = $(this).closest('.card-body').find('.activation__input5');
            if (this.checked) {
                $(input_element).prop('disabled', false);
            } else {
                $(input_element).prop('disabled', true);
            }
        });

        $(".activation__checkbox1").change(function () {
            var input_element = $(this).closest('.card-body').find('.activation__input2');
            if (this.checked) {
                $(input_element).prop('disabled', false);
            } else {
                $(input_element).prop('disabled', true);
            }

            var input_element = $(this).closest('.card-body').find('.activation__checkbox2');
            if (this.checked) {
                $(input_element).prop('checked', true);
                $(input_element).prop('disabled', false);
            } else {
                $(input_element).prop('checked', false);
                $(input_element).prop('disabled', true);
            }
        });
    </script>

    <script>
        $('.selectpicker').selectpicker();
        PageLoadActions();
    </script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>

    <script>
        $(function () {
            $(".DTForm").submit(function () {
                dataSourceAjaxServer.init();
                return false;
            });
        });
        var dataSourceAjaxServer = function () {
            var initTable1 = function () {
                var table = $('#dataTableId');
                // begin first table
                table.DataTable({
                    language: {
                        emptyTable: "لا يوجد بيانات لعرضها", info: "عرض _START_ الى _END_ من _TOTAL_ صف", infoEmpty: "لا يوجد نتائج", infoFiltered: "(filtered1 من _MAX_ اجمالي صفوف)", lengthMenu: "_MENU_", search: "بحث", zeroRecords: "لا يوجد نتائج لعرضها"
                    },
                    responsive: true,
                    searchDelay: 500,
                    processing: true,
                    serverSide: true,
                    sPaginationType: "full_numbers",
                    bDestroy: true,
                    bSort: false,
                    bLengthChange: true,
                    dom:
                        "<'row'<'col-sm-12'tr>>" +
                        "<'row'<'col-sm-4'i><'col-sm-4 text-center'l><'col-sm-4'p>>",
                    ajax: {
                        type: "POST",
                        contentType: "application/json",
                        url: '@Url.Action("AjaxData", "StoreVouchers")',
                        data: function (d) {
                            d.SearchKey = ($("[name=SearchKey]").val());
                            return JSON.stringify(d);
                        }
                    },
                    columns: [
                        { data: 'VoucherNameAr' },
                        { data: 'VoucherNameEn' },
                        {
                            "render": function (data, type, row) {
                                return '<span style="font-size: 13px;" class="label label-sm text-black rounded label-primary bg-secondary label-inline font-weight-bold pr-2 pl-2">' + row["NumOfCoins"] + '</span>';
                            }
                        },
                        {
                            "render": function (data, type, row) {
                                if (row["IsActive"]) {
                                    return '<span style="font-size: 13px;" class="label label-sm text-white rounded label-primary bg-success label-inline font-weight-bold pr-2 pl-2">فعال</span>';
                                }
                                return '<span style="font-size: 13px;" class="label label-sm text-white rounded label-primary bg-danger label-inline font-weight-bold pr-2 pl-2">معطل</span>';
                            }
                        },
                        {
                            "render": function (data, type, row) {
                                return '<span class="text-primary">' + row["VoucherExpiredAfterDay"] + ' <small>يوم</small></span>';
                            }
                        },
                        { data: 'InsertDate' },
                        { data: 'Actions', responsivePriority: -1 },
                    ],
                    columnDefs: [
                        {
                            targets: -1,
                            orderable: false,
                            render: function (data, type, row, meta) {
                                return ''
                                    + '<span class="dropdown">'
                                    + '<a href="#" class="btn btn-sm btn-clean btn-icon btn-icon-md" data-toggle="dropdown" aria-expanded="true">'
                                    + '<i class="la la-ellipsis-h"></i></a>'
                                    + '<div class="dropdown-menu dropdown-menu-right">'
                                    + '<a class="Confirm dropdown-item text-danger" tname="#dataTableId" href="@Url.Action("Delete", "StoreVouchers")/' + row["VoucherId"] + '"><i class="la la-trash text-danger"></i> حذف القسيمة</a>'
                                    + '</div></span>'
                                    + '<a href="@Url.Action("Edit", "StoreVouchers")/' + row["VoucherId"] + '" title="تعديل القسيمة" class="btn btn-sm btn-clean btn-icon btn-icon-md"><i class="la la-edit"></i></a>';
                            },
                        }
                    ],
                });
            };

            return {
                init: function () {
                    initTable1();
                },
            };
        }();
        jQuery(document).ready(function () {
            dataSourceAjaxServer.init();
        });


    </script>
}
